<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-06-17 Tue 14:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My background</title>
<meta name="generator" content="Org Mode" />
<style type='text/css'>
<!--/*--><![CDATA[/*><!--*/
/* nice-org-html.css
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
*/

/* basic layout ***************************************************************/
*,
*::before,
*::after {
    box-sizing: border-box;
}
html {
    font-family: Sans;
    line-height: 1.3;
    font-size: calc(15px + 0.390625vw);
    -webkit-text-size-adjust: 100%;
}

body {
    background: #999; /* overwritten with theme --bg */
    width: 100%;
    min-height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family:
	-apple-system,
	BlinkMacSystemFont,
	segoe ui,
	Roboto,
	Oxygen,
	Ubuntu,
	Cantarell,
	open sans,
	helvetica neue,
	sans-serif,
	system-ui
}

#preamble,
#postamble {
    width: 100%;
}

#content {
    width: 80%;
    max-width: 80ch;
    margin-left: 1rem;
    margin-right: 1rem;
    flex: 1;
}

/* custom facing **************************************************************/
/* The variable values are injected by CSS pre-processing in et-org-html.el */
:root {
    --bc-tb: #383a42;
    --bc-block: initial;
    --clr: #383a42;
    --clr-tb-hd: initial;
    --clr-code: initial;
    --bg: #fafafa;
    --bg-code: #f0f0f1;
    --bg-tb-hd: #f0f0f1;
    --bg-block: initial;
    --clr-link: #008B8B;
    --clr-title: #383a42;
    --clr-todo: #50a14f;
    --bg-todo: initial;
    --clr-done: #a0a1a7;
    --bg-done: initial;
    --ts-clr: #a626a4;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #a626a4;
    --bg-constant: initial;
    --clr-constant: #008B8B;
    --bg-comment: initial;
    --clr-comment: #a0a1a7;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #0184bc;
    --bg-variable: initial;
    --clr-variable: #8B4513;
    --bg-preprocessor: initial;
    --clr-preprocessor: initial;
    --bg-doc: initial;
    --clr-doc: initial;
    --bg-builtin: initial;
    --clr-builtin: #e44649;
    --bg-string: initial;
    --clr-string: #50a14f;
}

body[data-mode='light'] {
    background: var(--bg);
    color: var(--clr);
}

body[data-mode='dark'] {
    background: var(--bg);
    color: var(--clr);
    --bc-tb: #FF0000;
    --bc-block: initial;
    --clr: #F5F5F5;
    --clr-code: initial;
    --clr-tb-hd: initial;
    --bg: #333333;
    --bg-tb-hd: #4D4D4D;
    --bg-code: #4D4D4D;
    --bg-block: initial;
    --clr-link: #1E90FF;
    --clr-title: #F5F5F5;
    --clr-todo: #FFA07A;
    --bg-todo: initial;
    --clr-done: #CD853F;
    --bg-done: initial;
    --ts-clr: #20B2AA;
    --mg: 20px;
    --w-toc: 300px;
    --bg-keyword: initial;
    --clr-keyword: #20B2AA;
    --bg-constant: initial;
    --clr-constant: #1E90FF;
    --bg-comment: initial;
    --clr-comment: #CD853F;
    --bg-comment-delimiter: initial;
    --clr-comment-delimiter: initial;
    --bg-function: initial;
    --clr-function: #00FF7F;
    --bg-variable: initial;
    --clr-variable: #9ACD32;
    --bg-preprocessor: initial;
    --clr-preprocessor: #6495ED;
    --bg-doc: initial;
    --clr-doc: #CD5C5C;
    --bg-builtin: initial;
    --clr-builtin: #76EE00;
    --bg-string: initial;
    --clr-string: #FFA07A;
}

/* exceptions for badly rendering themes **************************************/
body[data-theme='leuven'],
body[data-theme='leuven-dark'] {
    --bg-code: var(--bg-block);
}

/* ootb page layout ***********************************************************/
#view-controls {
    position: sticky;
    display: flex;
    align-items: center;
    justify-content: center;
    top: 0;
    left: 0;
    width: 100%;
    background: var(--bg);
    color: var(--clr-code);
    height: 2.5rem;
    padding-top: 1.25rem;
    padding-bottom: 1.25rem;
    z-index: 100;
    border-radius: 5px; /* Rounded corners */
}
#toggle-mode {
    position: absolute;
    right: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#goto-top {
    display: none;
}
#goto-top[data-show="true"] {
    position: relative;
    display: block;
    text-align: center;
    font-size: 1rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}
#toggle-toc {
    display: none;
}
#toggle-toc[data-show="true"] {
    position: absolute;
    left: 5%;
    display: block;
    text-align: center;
    font-size: 1.5rem;
    background: var(--bg);
    color: var(--clr-code);
    padding: 0.25rem 0;
}

#toggle-toc:hover,
#goto-top:hover,
#toggle-mode:hover {
    cursor: pointer;
}

#table-of-contents {
    display: none;
}
#table-of-contents[data-show="true"] {
    width: 80%;
    max-width: 80rem;
    margin-left: 1rem;
    margin-right: 1rem;
    background: var(--bg);
    scrollbar-width: none;
    -ms-overflow-style: none;
}

#table-of-contents::-webkit-scrollbar {
    display: none;
}

body[data-toc="true"] #content * {
    display: none;
}
body[data-toc="true"] #content #table-of-contents,
body[data-toc="true"] #content #table-of-contents * {
    display: block;
}


/* misc elements **************************************************************/

hr {
    height: 0;
    color: inherit;
}

b,
strong {
    font-weight: bolder;
}

code,
kbd,
samp,
pre {
    font-family:
	Menlo,
	ui-monospace,
	SFMono-Regular,
	Consolas,
	'Liberation Mono',
	monospace;
}

small {
    font-size: 80%;
}

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sub {
    bottom: -0.25em;
}

sup {
    top: -0.5em;
}

table {
    text-indent: 0;
    border-color: inherit;
}

summary {
    display: list-item;
}

h1 {
    color: var(--clr-title);
    text-align: center;
}
h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
}

code {
    color: var(--clr-code);
    background: var(--bg-code);
    border-radius: 2px;
    padding-left: 5px;
    padding-right: 5px;
}

pre::-webkit-scrollbar {
    display: none;
}

.todo {
    color: var(--clr-todo);
    background: var(--bg-todo);
}

.done {
    color: var(--clr-done);
    background: var(--bg-done);
}

.timestamp-wrapper {
    font-size: 0.8rem;
    color: var(--clr-ts);
}

table {
    width: 100%;
    border: 2px solid var(--bc-tb);
}

thead {
    color: var(--clr-tb-hd);
    background: var(--bg-tb-hd);
}

td, th {
    border: thin solid var(--bc-tb);
}

li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}
#text-table-of-contents li a:before {
    content: "â€¢ "
}

a {
    text-decoration: none;
    color: var(--clr-link);
}

a:hover {
    text-decoration: underline;
}

.MathJax_Display {
    font-size: 1.25em;
}

img {
    max-width: 100%;
}

pre {
    padding: 1rem;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-block);
    font-size: 0.9rem;
    overflow-x: auto;
    -ms-overflow-style: none;
    scrollbar-width: thin;
}

.org-src-wrapper {
    position: relative;
    border: 1px solid var(--bc-block);
    border-radius: 0.5rem;
    background: var(--bg-code);
}

.org-src-bar {
    position: relative;
    top: 0rem;
    width: 100%;
    background: var(--bg-code);
    border-radius: 0.5rem;
    text-align: right;
    min-height: 1rem;
}

.org-src-wrapper .org-src-container {
    position: relative;
    border: none;
    border-radius: 0.5rem;
    background: var(--bg-code);
    z-index: 0;
}

.org-src-wrapper .org-src-container pre.src {
    border: none !important;
    background: var(--bg-code) !important;
    padding-top: 0rem;
    padding-bottom: 0rem;
    margin-top: 0rem;
    margin-bottom: 0rem;
    padding-bottom: 1.6rem;
}

.org-src-wrapper .org-src-bar .srcLangLabel {
    top: 0rem;
    right: 1.6rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    font-size: 0.8rem;
    opacity: 0.5;
    z-index: 1;
    display: none;
}

.org-src-wrapper .org-src-bar .copyBtn {
    top: 0rem;
    right: 0.1rem;
    background-color: transparent;
    color: var(--clr-doc);
    border: none;
    padding: 0.5rem;
    padding-right: 0.7rem;
    padding-bottom: 0.3rem;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 0.8rem;
    cursor: pointer;
    opacity: 0.5;
    z-index: 1;
    transition: opacity 0.3s;
}

.org-src-wrapper .copyBtn:hover {
    opacity: 1;
}

.org-src-wrapper .copyBtn i {
    margin-right: 0.5rem;
    padding: 0.5rem;
}

/* responsive layouts *********************************************************/

@media only screen and (max-width: 768px) {
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}

@media only screen and (max-width: 480px) {
    #view-controls {
	padding-top: 1.5em;
	padding-bottom: 1.5em;
    }
    #toggle-toc[data-show='true'] {
	padding-right: 5%;
    }
    #toggle-mode {
	padding-left: 5%;
    }
    #content {
	width: 90%;
    }
}


/* generated header and footer ************************************************/

#generated-header,
#generated-footer {
    width: 90%;
    margin-left: 5%;
    margin-right: 5%;
    line-height: 1;
}
.generated header {
    top: 0;
    left: 0;
}
.generated footer {
    bottom: 0;
    left: 0;
}
.generated header a,
.generated footer a {
    display: inline;
    color: var(--clr-title);
    text-decoration: none;
    transition: color .15s ease-in;
}
.generated header a:hover,
.generated footer a:hover {
    color: var(--clr-link);
}

.generated header nav {
    position: relative;
    margin-top: 1rem;
    top: 0;
    left: 0;
}
.generated footer nav {
    position: relative;
    bottom: 0;
    left: 0;
}

.generated .separator {
    display: block;
    width: 111%;
    margin-left: -5.5%;
    max-width: 100vw;
    height: 0.125rem;
    background: var(--bg-code);
}

.generated a .nav-title,
.generated a .nav-author {
    display: inline;
    margin-top: 1rem;
    margin-bottom: 1rem;
    padding-right: 10rem;
}

.generated .nav-title {
    letter-spacing: .075rem;
    font-weight: 500;
}

.generated .nav-toggle {
    display: none;
}
.generated .nav-button {
    display: none;
}
.generated .nav-list {
    overflow-y: hidden;
    display: block;
    float: right;
    list-style: none;
    margin-bottom: 0;
    margin-top: 0;
}

.generated .nav-item {
    position: relative;
    float: left;
    margin: 0;
}
.generated .nav-link {
    position: relative;
    float: right;
    margin-left: 2rem;
    margin-right: 0rem;
}

.generated .nav-toggle {
    max-height: 0;
    visibility: hidden;
    overflow-y: hidden;
}

.generated header .separator {
    margin-top: 1rem;
    margin-bottom: 0;
}

.generated footer .separator {
    margin-bottom: 1rem;
    margin-top: 0;
}

.generated .menu-sep {
    display: none;
    max-height: 0;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}

.generated footer {
    padding-bottom: 1rem;
}

.generated.compact footer {
    padding-bottom: 0;
}

.generated.compact header .separator {
    margin-top: 0;
    margin-bottom:0;
}
.generated.compact footer .separator {
    margin-bottom: 1rem;
}

.generated.compact .nav-toggle {
    visibility: visible;
}

.generated.compact .nav-toggle + label span::before {
    transition: all 0.2s ease-in;
}
.generated.compact .nav-toggle:checked + label span::before {
    transform: translateX(0.04rem) translateY(-0.25rem) rotate(90deg);
    transition: all 0.2s ease;
}

.generated.compact .menu-sep {
    display: flex;
    max-height: 0rem;
}
.generated.compact .nav-toggle:checked + label + .menu-sep {
    display: block;
    position: relative;
    max-height: 1rem;
    transition: max-height 0.2s ease;
}

.generated.compact .nav-list {
    float: none !important;
    position: relative;
    display: block;
    padding-left: 0;
    padding-right: 0;
    z-index: 5;
    width: 100%;
    height: auto;
    max-height: 0;
    margin: 0;
    overflow-x: hidden;
    overflow-y: hidden;
    transition: max-height 0.2s ease;
}
.generated.compact .nav-toggle:checked + label ~ .nav-list {
    display: block;
    max-height: 100rem;
    overflow-y: hidden;
}
.generated.compact header .nav-toggle:checked + label ~ .nav-list {
    transition: max-height 0.2s ease;
}

.generated.compact .nav-button {
    display: inline;
    position: relative;
    float: right;
    font-size: 1rem;
}
.generated.compact .nav-button span::before {
    display: inline-block;
    content: '\2807';
    font-size: 2rem;
    transform: translateX(0.25rem) translateY(-0.5rem);
}

.generated.compact .nav-item {
    float: none !important;
    text-align: center !important;
}
.generated.compact .nav-link {
    line-height: 2rem;
    margin-left: 2rem;
    margin-right: 2rem;
    float: none !important;
}

.generated.compact footer .separator.menu-sep {
    margin-bottom: -1rem;
}

.hidden {
    display: none;
}

.collapsible:hover {
    cursor: pointer;
}

.collapsible.collapsed::after {
    display: inline-block;
    content: '...';
}
h6::before { content: '';
margin-right: calc(0 * 0.26em);
}
h5::before { content: '';
margin-right: calc(0 * 0.25em);
}
h4::before { content: '';
margin-right: calc(0 * 0.24em);
}
h3::before { content: '';
margin-right: calc(0 * 0.23em);
}
h2::before { content: '';
margin-right: calc(0 * 0.22em);
}
. {
    font-family: "Consolas", "Liberation Mono", "Courier", sans-serif;
}

h2 {
    font-size: 130%;
}

h3 {
    font-size: 100%;
}


/* for the header */

/* Style the header with a grey background and some padding */
.header {
    /* ho */
    overflow: hidden;
    padding: 20px 10px;
}

/* Style the header links */
.header a {
    float: left;
    color: var(--clr);
    text-align: center;
    padding: 12px;
    text-decoration: none;
    font-size: 18px;
    line-height: 25px;
    border-radius: 4px;
}

.link {
    text-align: center;
}
.header a.title{
    font-weight: bold;
}

/* Change the background color on mouse-over */
.header a:hover {
    color: pink;
}

/* Float the link section to the right */
.header-right {
    float: right;
}

/* Add media queries for responsiveness - when the screen is 500px wide or less, stack the links on top of each other */
@media screen and (max-width: 750px) {
    .header a {
	float: none;
	display: block;
	text-align: left;
    }
    .header a.title{
	clear: right;
    }
    .header-right {
	float: none;
    }
}

/*]]>*/-->
</style>
</head>
<body>
<div id="preamble" class="status">
<div id='injected-header' class='injected'><div class="header">
  <a href="index.html" class="title">Website::NÃ©stor Narbona Chulvi</a>
  <div class="header-right">
    <a class="link" href="index.html">Home</a>
    <a class="link" href="background.html">Background</a>
    <a class="link" href="projects.html">Projects</a>
    <a class="link" href="documents/cv.pdf">CV</a>
  </div>
</div>
</div><div id='view-controls'><div id='toggle-mode' title='Mode'>&#9788;</div><div id='goto-top' title='Top'>&#8963;</div><div id='toggle-toc' title='Contents'>&#9776;</div></div>
</div>
<div id="content" class="content">
<h1 class="title">My background</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd4cccf8">Professional career</a>
<ul>
<li><a href="#orgf157ea9">[FEB 2024 - MAY 2025] Data Scientist - MLP</a></li>
<li><a href="#orgab9c1ab">[JAN 2023 - FEB 2024] Teacher Assistant - University of Amsterdam</a></li>
<li><a href="#orge843868">[MAY 2021 - JUN 2022] Junior Lecturer - Athena Studies</a></li>
<li><a href="#orgd7a7272">[FEB 2020 - NOV 2021] Editor - Spiegeloog</a></li>
</ul>
</li>
<li><a href="#orga877283">Academic career</a>
<ul>
<li><a href="#org00cbe8a">[SEP 2022 - JAN 2023] Computational Science Minor - University of Amsterdam</a></li>
<li><a href="#org784fcb4">[SEP 2019 - JUN 2022] Psychology Major - University of Amsterdam</a></li>
<li><a href="#org5e3ffc7">[SEP 2017 - JUN 2019] International Baccalaureate (IB)</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
Here you can find all about my current and previous professional
roles, as well as my academic career. Too long? Click on <b>â˜°</b> for an
overview.
</p>
<div id="outline-container-orgd4cccf8" class="outline-2">
<h2 id="orgd4cccf8">Professional career</h2>
<div class="outline-text-2" id="text-orgd4cccf8">
</div>
<div id="outline-container-orgf157ea9" class="outline-3">
<h3 id="orgf157ea9">[FEB 2024 - MAY 2025] Data Scientist - MLP</h3>
<div class="outline-text-3" id="text-orgf157ea9">
<p>
<a href="https://www.mlprograms.com/">MLP</a> stands for Machine Learning ProgramsðŸ˜® and thats what we do. In
particular we use ML to help actors in the insurance sector better
understand the market, asses risk and, overall, improve their
business. We are part of the larger <a href="https://opengi.co.uk/">Open Gi</a>, a UK insurance software
house. We are a small company and, thus, my role covers the entire
pipeline from raw data to final product (e.g. initial data cleaning
and analysis, development of models, building and testing of product
infrastructure).
</p>
</div>
</div>
<div id="outline-container-orgab9c1ab" class="outline-3">
<h3 id="orgab9c1ab">[JAN 2023 - FEB 2024] Teacher Assistant - University of Amsterdam</h3>
<div class="outline-text-3" id="text-orgab9c1ab">
<p>
Guiding practical sessions, developing teaching material and grading
for the <a href="https://www.uva.nl/en/programmes/bachelors/computational-social-science/study-programme/study-programme.html#Year-1">Computational Social Sciences</a> bachelor at the University of
Amsterdam. I taught students how to program (Python, SQL, HTML, CSS),
and how to develop small scale web applications with an immediate
social impact. 
</p>
</div>
</div>
<div id="outline-container-orge843868" class="outline-3">
<h3 id="orge843868">[MAY 2021 - JUN 2022] Junior Lecturer - Athena Studies</h3>
<div class="outline-text-3" id="text-orge843868">
<p>
<a href="https://athenastudies.co.uk/">Athena Studies</a> is the number one company offering study assistance to
university students in the Netherlands. I was in charge of different
statistics courses, preparing the material and giving the (some times
days long) lectures. Although it was hard work, I enjoyed it got often
rewarded with great feedback from students. They once rated me high
enough for my boss' boss to <a href="documents/india_letter.pdf">congratulate</a> meðŸ’ª.
</p>
</div>
</div>
<div id="outline-container-orgd7a7272" class="outline-3">
<h3 id="orgd7a7272">[FEB 2020 - NOV 2021] Editor - Spiegeloog</h3>
<div class="outline-text-3" id="text-orgd7a7272">
<p>
During the my first years in university I was an editor for the
Psychology faculty's magazine. There I wrote a few articles and
conducted interviews. In the end, it appears, I chose data science
over journalism, but you can still <a href="https://www.spiegeloog.amsterdam/author/nestor/">check some of that work</a>. 
</p>
</div>
</div>
</div>
<div id="outline-container-orga877283" class="outline-2">
<h2 id="orga877283">Academic career</h2>
<div class="outline-text-2" id="text-orga877283">
</div>
<div id="outline-container-org00cbe8a" class="outline-3">
<h3 id="org00cbe8a">[SEP 2022 - JAN 2023] Computational Science Minor - University of Amsterdam</h3>
<div class="outline-text-3" id="text-org00cbe8a">
<p>
I finished the minor with a GPA of 8.75/10 (you may check the
<a href="./documents/transcript_psych.pdf">transcripts</a>ðŸ‘€). The program included courses in programming for data
analysis and modeling, as well as others focused on the mathematical
underpinnings of data analysis and statistical methods.
</p>
</div>
</div>
<div id="outline-container-org784fcb4" class="outline-3">
<h3 id="org784fcb4">[SEP 2019 - JUN 2022] Psychology Major - University of Amsterdam</h3>
<div class="outline-text-3" id="text-org784fcb4">
<p>
I specialized in Research Methods and Statistics, which filled my
coursework with scientific data analysis, programming and modeling. I
also followed a <a href="https://www.merriam-webster.com/dictionary/gamut">gamut</a> of courses on behavioral change and social
psychology. I graduated with a GPA of 8.19/10 with Honours (+30ECS)
and distinction (you may check the <a href="./documents/transcript_psych.pdf">transcripts</a>ðŸ‘€). My thesis had by
title <i>Using Social Media Analytics to Explore Political Involvement
and Polarization</i>, which involved a fair bit NLP and statistical
analysis. My supervisor, Prof. Dr. Han van der Maas, was kind enough
to award me a 9.5/10 and write me a <a href="./documents/han_letter.pdf">recommendation letter</a>.
</p>
</div>
</div>
<div id="outline-container-org5e3ffc7" class="outline-3">
<h3 id="org5e3ffc7">[SEP 2017 - JUN 2019] International Baccalaureate (IB)</h3>
<div class="outline-text-3" id="text-org5e3ffc7">
<p>
During my high school years, I pursued the International Baccalaureate
(IB) program, achieving a GPA of 41 out of a possible 45. My courses
encompassed a diverse range of subjects, including Business
Management, Spanish Literature, French, Mathematics, and History.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
if (!document.cookie.split('; ').find(r => r.startsWith('mode'))) {
document.cookie = 'mode=dark'
}
document.cookie = 'light=tsdh-light'
document.cookie = 'dark=tsdh-dark'
/*
;; nice-org-html.js
;;==============================================================================
;; Copyright (C) 2024, Ewan Townshend

;; Author: Ewan Townshend
;; URL: https://github.com/ewantown/nice-org-html
;; Version: 1.2

;;==============================================================================
;; This program is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation, either version 3 of the License, or
;; (at your option) any later version.

;; This program is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.

;; You should have received a copy of the GNU General Public License
;; along with this program.  If not, see <https://www.gnu.org/licenses/>.

;; This file is not part of emacs.

;;==============================================================================
;; JS for html exported by et-org-html.el
 */

const preamble = document.getElementById("preamble");
const content = document.getElementById("content");
const postamble = document.getElementById("postamble");

const controls = document.getElementById("view-controls");
const toggleTocBtn = document.getElementById("toggle-toc");
const gotoTopBtn = document.getElementById("goto-top");
const toggleModeBtn = document.getElementById("toggle-mode");
const toc = document.getElementById("table-of-contents");

// Get and parse options passed in cookie string
const optCookie = document.cookie.split('; ').find(r => r.startsWith('options'));
const options = {};
if (optCookie) {
  optCookie.split('=')[1].split('__').forEach(pair => {
    const [key, val] = pair.split(':');
    if (key && val) {
      options[key] = val;
    }
  })
}

// Move sticky control bar (injected within preamble)
document.body.insertBefore(controls, content);

// Mode handling
function getMode() {
  let cookie = document.cookie.split('; ').find(r => r.startsWith('mode'))
  return cookie && cookie.split("=")[1];
}

function setMode(mode) {
  document.body.dataset.mode = mode;
  let thmCookie = document.cookie.split('; ').find(r => r.startsWith(mode));
  document.body.dataset.theme = thmCookie ? thmCookie.split('=')[1] : 'unknown';
  toggleModeBtn.innerHTML = (mode === 'light') ? '&#9789;' : '&#9788;';
  document.cookie = 'mode=' + mode;
}

// Initially, set mode based on stored cookie
let mode = getMode();
if (mode && ["light", "dark"].includes(mode)) {
  setMode(mode);
} else {  
  let prop = "prefers-color-scheme";
  let pref = (mode === "query") && window.matchMedia &&
    ["light", "dark"].find(s => window.matchMedia(`(${prop}: ${s})`).matches);
  setMode(pref || "dark"); // fallback: dark
}

// Mode toggling
toggleModeBtn.addEventListener('click', () => {
  setMode(document.body.dataset.mode === 'dark' ? 'light' : 'dark');
})


// Jump to top
let scrollY = document.documentElement.scrollTop;
window.addEventListener('scroll', () => {
  let atTop = document.documentElement.scrollTop <= preamble.offsetHeight;
  gotoTopBtn.dataset.show = !atTop + "";
});
gotoTopBtn.addEventListener('click', () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  });
})

// Table-of-contents toggling
if (toc) {
  toggleTocBtn.dataset.show = 'true';
  toggleTocBtn.addEventListener('click', () => {
    let showingToc = document.body.dataset.toc;
    scrollY = showingToc ? scrollY : document.documentElement.scrollTop;
    if (showingToc) {
      document.body.dataset.toc = '';
      document.documentElement.scrollTop = scrollY;
    } else {
      let tocHeight =
	Math.max(
	  window.innerHeight - controls.offsetHeight,
	  toc.offsetHeight
	);
      const header = document.getElementById("injected-header");
      if (header && (scrollY > header.offsetHeight)) {
	document.documentElement.scrollTop = preamble.offsetHeight;
      }
      toc.style.height = `${tocHeight}px`;
      document.body.dataset.toc = 'true';
    }
    toc.addEventListener('click', () => {
      if (document.body.dataset.toc) {
	document.body.dataset.toc = '';
	document.documentElement.scrollTop = scrollY;
      }
    })
  })
};

// Instrument anchor linking for sticky control bar
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', (e) => {
    e.preventDefault();
    const targetId = e.currentTarget.getAttribute('href');
    const target = document.querySelector(targetId);

    setTimeout(() => {
      const targetPos = target.getBoundingClientRect().top;
      let offset = targetPos + document.documentElement.scrollTop;
      offset -= controls.offsetHeight;
      window.scrollTo({
	top: offset,
	behavior: "smooth"
      });
    }, 0);
  });
});

function copyTextToClipboard(text) {
  // Make invisible textarea
  var textArea = document.createElement("textarea");
  textArea.style.position = 'fixed';
  textArea.style.top = 0;
  textArea.style.left = 0;
  textArea.style.width = '2em';
  textArea.style.height = '2em';
  textArea.style.padding = 0;
  textArea.style.border = 'none';
  textArea.style.outline = 'none';
  textArea.style.boxShadow = 'none';
  textArea.style.background = 'transparent';

  // Copy contents into it
  textArea.value = text;

  // Try to copy from it to clipboard
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  var res;
  try {
    res = document.execCommand('copy');
  } catch (err) {
    res = false;
  }

  // Remove invisible textarea
  document.body.removeChild(textArea);

  return res;
}

// Handle the default header / footer drawers
const header = document.getElementById("generated-header");
const footer = document.getElementById("generated-footer");

if (header) {
  let toggle = header.querySelector("header nav input.nav-toggle");
  if (toggle) { toggle.checked = false; }
}
if (footer) {
  let nav = footer.querySelector("nav");
  let toggle = nav && nav.querySelector(".nav-toggle");
  let navList = nav && nav.querySelector(".nav-list");
  let navElem = navList && [...navList.querySelectorAll(".nav-item")];
  let numLink = navElem && navElem.length;
  if (numLink) {
    toggle.checked = false;
    toggle.addEventListener('change', () => {
      if (toggle.checked) {
	setTimeout(() => window.scrollTo({
	  behavior: 'smooth',
	  top: document.body.scrollHeight	  
	}), 88);
      }
   });
  }
}

function autoCompact() {
  var anchor, links, overlap, trivial;
  const domCompute = (node) => {
    if (node) {
      anchor = node.querySelector('.nav-title, .nav-author');
      links = node.querySelector('.nav-list');
      overlap = links.offsetLeft - 5 <= anchor.offsetLeft + anchor.offsetWidth;	
      trivial = links.offsetLeft === anchor.offsetLeft;
    }
  };
  let mediaMatch = window.matchMedia('(max-width: 768px)').matches;
  [header, footer].forEach(e => {
    if (e) {
      if (mediaMatch) {
	e.classList.add('compact');
      } else {
	domCompute(e);
	if (overlap && !trivial) {
	  e.classList.add('compact');
	} else {	
	  let clone = e.cloneNode(true);
	  clone.style.top = '-2000px';
	  clone.style.maxHeight = '0px';
	  clone.classList.remove('compact');
	  e.parentNode.insertBefore(clone, e);
	  domCompute(clone);
	  let toggle = e.querySelector('.nav-toggle');
	  if (!overlap && toggle && !toggle.checked) {
	    e.classList.remove('compact');
	  }
	  e.parentNode.removeChild(clone);
	}
      }
    }
  })
}

if ((header || footer)) {
  if (options.hasOwnProperty('layout')) {
    [header, footer].forEach(e => e ? e.classList.add(options.layout) : null);
  } else {
    autoCompact();
    window.addEventListener('resize', autoCompact);
  }
}

if (options.hasOwnProperty('src-lang') && options['src-lang'] == 't') {
  let labels = [...document.querySelectorAll('.srcLangLabel')];
  labels.forEach(l => l.style.display = 'inline-block');
}

if (options.hasOwnProperty('collapsing') && options.collapsing == 't') {
  let levels = [2, 3, 4, 5, 6];
  let containerPrefix = 'outline-container-';
  levels.forEach(l => {
    let containers = [...document.querySelectorAll(`.outline-${l}`)];
    containers.forEach(c => {
      let id = c.id.slice(containerPrefix.length);
      let headline = document.getElementById(id);
      let siblings = [...c.children].filter(child => child.id != id);
      headline.classList.add('collapsible');
      headline.addEventListener('click', () => {	
	if (headline.classList.contains('collapsed')) {
	  headline.classList.remove('collapsed');
	  siblings.forEach(child => {
	    child.classList.remove('hidden');
	  });	  
	} else {
	  headline.classList.add('collapsed');
	  siblings.forEach(child => {
	    child.classList.add('hidden');
	  });
	}
      })
    })
  })
}
/*]]>*/-->
</script><div hidden>Generated by: https://github.com/ewantown/nice-org-html</div>
</div>
</body>
</html>
